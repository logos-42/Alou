import u from"axios";import{round as b}from"mathjs";import{snakeCase as sr,camelCase as or}from"lodash";var $={outstanding_balance:"/billing_info/outstanding_balance",custom_id:"/custom_id",fixed_price:"/plan/billing_cycles/@sequence=={0}/pricing_scheme/fixed_price",payment_failure_threshold:"/plan/payment_preferences/payment_failure_threshold",auto_bill_outstanding:"/plan/payment_preferences/auto_bill_outstanding",taxes_inclusive:"/plan/taxes/inclusive",taxes_percentage:"/plan/taxes/percentage",shipping_amount:"/shipping_amount",shipping_address:"/subscriber/shipping_address"};import St from"debug";var Ct=St("agent-toolkit:payloadUtils");function E(e){try{let o=e.currencyCode,r=[],a=e.items.reduce((g,y)=>g+y.itemCost*y.quantity,0),s=e.shippingCost||0,i=e.items.reduce((g,y)=>g+y.itemCost*y.taxPercent*y.quantity/100,0),c=e.discount||0,d=a+i+s-c,p={item_total:{value:b(a,2).toString(),currency_code:o},shipping:{value:b(s,2).toString(),currency_code:o},tax_total:{value:b(i,2).toString(),currency_code:o},discount:{value:b(c,2).toString(),currency_code:o}};e.items.forEach(g=>{r.push({name:g.name,description:g.description,unit_amount:{value:g.itemCost.toString()||"0",currency_code:o},quantity:g.quantity.toString()||"1",tax:{value:b(g.itemCost*g.taxPercent/100,2).toString()||"0",currency_code:o}})});let l={amount:{value:b(d,2).toString(),currency_code:o,breakdown:p},items:r},f={intent:"CAPTURE",purchase_units:[e.shippingAddress?{...l,shipping:{address:e.shippingAddress}}:l]};return(e.returnUrl||e.cancelUrl)&&(f.payment_source={paypal:{experience_context:{return_url:e.returnUrl,cancel_url:e.cancelUrl}}}),f}catch(o){throw console.error(o),new Error("Failed to parse order details")}}var wt=["custom_id","taxes_inclusive","taxes_percentage","shipping_amount","shipping_address"],k=(e,o)=>{let r=e.currency_code||"USD",a=[];for(let s in e){if(s==="subscription_id"||s==="currency_code")continue;let i=$[s];if(!i)throw new Error(`Unsupported field for update: ${s}`);let c="replace";if(wt.includes(s)){let l=i.split("/");l.shift(),l.reduce((f,g)=>f?.[g],o)===void 0&&(c="add")}let d={op:c,path:i},p=e[s];s==="fixed_price"&&(d.path=i.replace("{0}",p?.sequence||1),delete p?.sequence,p=p?.value),["outstanding_balance","shipping_amount","fixed_price"].includes(s)?d.value={currency_code:r,value:p}:d.value=p,a.push(d)}return Ct("Update Subscription Operations",JSON.stringify(a)),a};function _(e){return Object.entries(e).filter(([o,r])=>r!=null).map(([o,r])=>`${encodeURIComponent(o)}=${encodeURIComponent(String(r))}`).join("&")}import Dt from"debug";var n=Dt("agent-toolkit:functions");async function U(e,o,r){n("[createInvoice] Starting invoice creation process");let a=await e.getHeaders();n("[createInvoice] Headers obtained");let s=`${e.getBaseUrl()}/v2/invoicing/invoices`;n(`[createInvoice] API URL: ${s}`);try{n("[createInvoice] Sending request to PayPal API");let i=await u.post(s,r,{headers:a});if(n(`[createInvoice] Invoice created successfully. Status: ${i.status}`),i.data&&i.data.rel==="self"&&i.data.href&&i.data.href.includes("/v2/invoicing/invoices/")&&i.data.method==="GET"){let c=i.data.href.split("/"),d=c[c.length-1];n("[createInvoice] Automatically sending invoice with thank you note");try{let p=await T(e,o,{invoice_id:d,note:"thank you for choosing us. If there are any issues, feel free to contact us",send_to_recipient:!0});return{createResult:i.data,sendResult:p}}catch(p){return n("[createInvoice] Error in auto-send invoice:",p.message),i.data}}else return n(`[createInvoice] Invoice ID: ${i.data.id||"N/A"}`),i.data}catch(i){n("[createInvoice] Error creating invoice:",i.message),h(i)}}async function q(e,o,r){n("[listInvoices] Starting to list invoices");let a=await e.getHeaders();n("[listInvoices] Headers obtained");let s=`${e.getBaseUrl()}/v2/invoicing/invoices`;n(`[listInvoices] API URL: ${s}`);try{n("[listInvoices] Sending request to PayPal API");let i=await u.get(s,{headers:a,params:r});return n(`[listInvoices] Invoices retrieved successfully. Status: ${i.status}`),i.data}catch(i){n("[listInvoices] Error listing invoices:",i.message),h(i)}}async function j(e,o,r){n("[getInvoice] Starting to get invoice");let a=await e.getHeaders();n("[getInvoice] Headers obtained");let s=`${e.getBaseUrl()}/v2/invoicing/invoices/${r.invoice_id}`;try{n("[getInvoice] Sending request to PayPal API");let i=await u.get(s,{headers:a});return n(`[getInvoice] Invoice retrieved successfully. Status: ${i.status}`),i.data}catch(i){n("[getInvoice] Error getting invoice:",i.message),h(i)}}async function T(e,o,r){n("[sendInvoice] Starting to send invoice"),n(`[sendInvoice] Context: ${JSON.stringify({sandbox:o.sandbox,merchant_id:o.merchant_id})}`);let{invoice_id:a,note:s,send_to_recipient:i,additional_recipients:c}=r,d=await e.getHeaders();n("[sendInvoice] Headers obtained");let p=`${e.getBaseUrl()}/v2/invoicing/invoices/${a}/send`;n(`[sendInvoice] API URL: ${p}`);try{n("[sendInvoice] Sending request to PayPal API");let l=await u.post(p,r,{headers:d});return n(`[sendInvoice] Invoice sent successfully. Status: ${l.status}`),l.data}catch(l){n("[sendInvoice] Error sending invoice:",l.message),h(l)}}async function L(e,o,r){n("[sendInvoiceReminder] Starting to send invoice reminder");let{invoice_id:a,note:s,subject:i,additional_recipients:c}=r,d=await e.getHeaders();n("[sendInvoiceReminder] Headers obtained");let p=`${e.getBaseUrl()}/v2/invoicing/invoices/${a}/remind`;try{n("[sendInvoiceReminder] Sending request to PayPal API");let l=await u.post(p,r,{headers:d});return n(`[sendInvoiceReminder] Invoice reminder sent successfully. Status: ${l.status}`),l.data}catch(l){n("[sendInvoiceReminder] Error sending invoice reminder:",l.message),h(l)}}async function B(e,o,r){n("[cancelSentInvoice] Starting to cancel sent invoice");let{invoice_id:a,note:s,send_to_recipient:i,additional_recipients:c}=r,d=await e.getHeaders();n("[cancelSentInvoice] Headers obtained");let p=`${e.getBaseUrl()}/v2/invoicing/invoices/${a}/cancel`;try{n("[cancelSentInvoice] Sending request to PayPal API");let l=await u.post(p,r,{headers:d});return l.status===204?(n(`[cancelSentInvoice] Invoice cancelled successfully. Status: ${l.status}`),{success:!0,invoice_id:a}):(n(`[cancelSentInvoice] Invoice cancellation response received. Status: ${l.status}`),l.data)}catch(l){n("[cancelSentInvoice] Error cancelling invoice:",l.message),h(l)}}async function H(e,o,r){let{invoice_id:a}=r,s={width:r.width,height:r.height},i=`${e.getBaseUrl()}/v2/invoicing/invoices/${a}/generate-qr-code`,c=await e.getHeaders();n("[generateInvoiceQrCodePrompt] Headers obtained");try{n("[cancelSentInvoice] Sending request to PayPal API");let d=await u.post(i,s,{headers:c});return d.status===204?(n(`[cancelSentInvoice] Invoice cancelled successfully. Status: ${d.status}`),{success:!0,invoice_id:a}):(n(`[cancelSentInvoice] Invoice cancellation response received. Status: ${d.status}`),d.data)}catch(d){n("[cancelSentInvoice] Error cancelling invoice:",d.message),h(d)}}async function N(e,o,r){let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v1/catalogs/products`;n(`[createProduct] Payload: ${JSON.stringify(r,null,2)}`);try{return(await u.post(s,r,{headers:a})).data}catch(i){throw console.error("Error Creating Product:",i.response?.data||i),i}}async function G(e,o,r){let a=await e.getHeaders(),{page:s=1,page_size:i=2,total_required:c=!0}=r,d=`${e.getBaseUrl()}/v1/catalogs/products?page_size=${i}&page=${s}&total_required=${c}`;try{return(await u.get(d,{headers:a})).data}catch(p){throw console.error("Error Listing Product:",p.response?.data||p),p}}async function z(e,o,r){let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v1/catalogs/products/${r.product_id}`;try{return(await u.get(s,{headers:a})).data}catch(i){throw console.error("Error Show Product Details:",i.response?.data||i),i}}async function M(e,o,r){let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v1/billing/plans`;n(`[createSubscriptionPlan] Payload: ${JSON.stringify(r,null,2)}`);try{return(await u.post(s,r,{headers:a})).data}catch(i){throw console.error("Error Creating Plan:",i.response?.data||i),i}}async function Q(e,o,r){let{page:a=1,page_size:s=10,total_required:i=!0,product_id:c}=r,d=`${e.getBaseUrl()}/v1/billing/plans?page_size=${s}&page=${a}&total_required=${i}`;c&&(d+=`&product_id=${c}`);let p=await e.getHeaders();try{return(await u.get(d,{headers:p})).data}catch(l){throw console.error("Error Creating Plan:",l.response?.data||l),l}}async function V(e,o,r){let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v1/billing/plans/${r.plan_id}`;try{return(await u.get(s,{headers:a})).data}catch(i){throw console.error("Error Show Plan Details:",i.response?.data||i),i}}async function F(e,o,r){let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v1/billing/subscriptions`;n(`[createSubscription] Payload: ${JSON.stringify(r,null,2)}`);try{return(await u.post(s,r,{headers:a})).data}catch(i){throw console.error("Error Creating Subscription:",i.response?.data||i),i}}async function I(e,o,r){let a=await e.getHeaders(),{subscription_id:s,get_additional_details:i}=r,c=`${e.getBaseUrl()}/v1/billing/subscriptions/${s}${i?"?fields=plan":""}`;try{return(await u.get(c,{headers:a})).data}catch(d){throw console.error("Error Show Subscription Details:",d.response?.data||d),d}}async function J(e,o,r){let a=await e.getHeaders(),{subscription_id:s,payload:i}=r,c=`${e.getBaseUrl()}/v1/billing/subscriptions/${s}/cancel`;try{return(await u.post(c,i,{headers:a})).data}catch(d){throw console.error("Error Creating Subscription:",d.response?.data||d),d}}async function Y(e,o,r){let a=await e.getHeaders(),{subscription_id:s}=r;try{let i=await I(e,o,{subscription_id:s,get_additional_details:!0}),c=k(r,i),d=`${e.getBaseUrl()}/v1/billing/subscriptions/${s}`;return(await u.patch(d,c,{headers:a})).data}catch(i){n("[updateSubscription] Error updating subscription:",JSON.stringify(i.message)),h(i)}}var K=async(e,o,r)=>{n("[createOrder] Starting order creation process");let a=await e.getHeaders(),s=`${e.getBaseUrl()}/v2/checkout/orders`,i=E(r);try{let c=await u.post(s,i,{headers:a});return n(`[createOrder] Order created successfully. Status: ${c.status}`),c.data}catch(c){n("[createOrder] Error creating order:",c.message),h(c)}},S=async(e,o,r)=>{n("[getOrder] Starting order retrieval process"),n(`[getOrder] Context: ${JSON.stringify({sandbox:o.sandbox,merchant_id:o.merchant_id})}`),n(`[getOrder] Order ID: ${r.id}`);let a=await e.getHeaders();n("[getOrder] Headers obtained");let s=`${e.getBaseUrl()}/v2/checkout/orders/${r.id}`;try{n("[getOrder] Sending GET request to PayPal API");let i=await u.get(s,{headers:a});return n(`[getOrder] Order retrieved successfully. Status: ${i.status}`),i.data}catch(i){n("[getOrder] Error retrieving order:",i.message),h(i)}},W=async(e,o,r)=>{try{n(`[captureOrder] Starting order capture process with params: ${JSON.stringify(r)}`);let a=`${e.getBaseUrl()}/v2/checkout/orders/${r.id}/capture`,s=await u.post(a,{},{headers:await e.getHeaders()});return n("[captureOrder] Response %s",s),s.status<=299?{status:"success",response:s.data}:{status:"error",response:s.data}}catch(a){throw console.error(a),new Error("Failed to capture order")}};async function Z(e,o,r){n("[createShipment] Starting shipment tracking creation process");let{tracking_number:a,transaction_id:s,status:i,carrier:c}=r,d=await e.getHeaders();n("[createShipment] Headers obtained");let p=`${e.getBaseUrl()}/v1/shipping/trackers-batch`;n(`[createShipment] API URL: ${p}`);let l={trackers:[{tracking_number:a,transaction_id:s,status:i,carrier:c}]};try{n("[createShipment] Sending request to PayPal API");let m=await u.post(p,l,{headers:d});return n(`[createShipment] Shipment tracking created successfully. Status: ${m.status}`),m.data}catch(m){n("[createShipment] Error creating shipment tracking:",m.message),h(m)}}async function X(e,o,r){n("[getShipmentTracking] Starting to get shipment tracking information");let{transaction_id:a,order_id:s}=r,i=await e.getHeaders();n("[getShipmentTracking] Headers obtained");let c=a;if(s&&!a){n("[getShipmentTracking] order_id provided but transaction_id is missing. Attempting to extract transaction_id from order details.");try{let p=await S(e,o,{id:s});if(p&&p.purchase_units&&p.purchase_units.length>0){let l=p.purchase_units[0];if(l.payments&&l.payments.captures&&l.payments.captures.length>0)c=l.payments.captures[0].id;else throw new Error("Could not find capture id in the purchase unit details.")}else throw new Error("Could not find purchase unit details in order details.")}catch(p){throw n(`[getShipmentTracking] Error extracting transaction_id from order details: ${p.message}`),new Error(`Error extracting transaction_id from order details: ${p.message}`)}}else if(!a)throw new Error("Either transaction_id or order_id must be provided.");let d=`${e.getBaseUrl()}/v1/shipping/trackers?transaction_id=${c}`;n(`[getShipmentTracking] API URL: ${d}`);try{n("[getShipmentTracking] Sending request to PayPal API");let p=await u.get(d,{headers:i});return n(`[getShipmentTracking] Shipment tracking retrieved successfully. Status: ${p.status}`),p.data}catch(p){n("[getShipmentTracking] Error retrieving shipment tracking:",p.message),h(p)}}async function ee(e,o,r){n("[listDisputes] Starting to list disputes");let a=await e.getHeaders();n("[listDisputes] Headers obtained");let s=`${e.getBaseUrl()}/v1/customer/disputes?${_(r)}`;try{n("[listDisputes] Sending request to PayPal API");let i=await u.get(s,{headers:a,params:r});return n(`[listDisputes] Disputes retrieved successfully. Status: ${i.status}`),i.data}catch(i){n("[listDisputes] Error listing disputes:",i.message),h(i)}}async function te(e,o,r){let{dispute_id:a}=r,s=await e.getHeaders();n("[getDispute] Headers obtained");let i=`${e.getBaseUrl()}/v1/customer/disputes/${a}`;n(`[getDispute] API URL: ${i}`);try{n("[getDispute] Sending request to PayPal API");let c=await u.get(i,{headers:s});return n(`[getDispute] Dispute details retrieved successfully. Status: ${c.status}`),c.data}catch(c){n(`[getDispute] Error retrieving dispute details for ID: ${a}:`,c.message),h(c)}}async function re(e,o,r){n("[acceptClaim] Starting to list disputes");let a=await e.getHeaders();n("[acceptClaim] Headers obtained");let s=`${e.getBaseUrl()}/v1/customer/disputes/${r.dispute_id}/accept-claim`;n(`[acceptClaim] API URL: ${s}`);try{n("[acceptClaim] Sending request to PayPal API");let i=await u.post(s,{note:r.note},{headers:a,params:r});return n(`[acceptClaim] Disputes retrieved successfully. Status: ${i.status}`),i.data}catch(i){n("[acceptClaim] Error listing disputes:",i.message),h(i)}}async function ne(e,o,r){let a=await e.getHeaders();if(n("[listTransactions] Headers obtained"),r.transaction_id){n(`[listTransactions] Searching for transaction with ID: ${r.transaction_id}`);let s=r.search_months||12;n(`[listTransactions] Will search up to ${s} months back for the transaction`);let i=new Date,c=new Date;c.setDate(i.getDate()-31);for(let d=0;d<s;d++){let p={...r};delete p.search_months,p.end_date=i.toISOString(),p.start_date=c.toISOString(),n(`[listTransactions] Searching month ${d+1}: ${c.toISOString()} to ${i.toISOString()}`);let l=`${e.getBaseUrl()}/v1/reporting/transactions?${_(p)}`;n(`[listTransactions] API URL: ${l}`);try{n("[listTransactions] Sending request to PayPal API");let m=await u.get(l,{headers:a,params:p});if(n(`[listTransactions] Transactions retrieved successfully. Status: ${m.status}`),m.data&&m.data.transaction_details&&m.data.transaction_details.length>0){let f=m.data.transaction_details.find(g=>g.transaction_info.transaction_id===r.transaction_id);if(f)return n(`[listTransactions] Found transaction with ID: ${r.transaction_id}`),{found:!0,transaction_details:[f],total_items:1}}i.setTime(c.getTime()),c.setMonth(c.getMonth()-1)}catch(m){n(`[listTransactions] Error searching transactions for month ${d+1}:`,m.message)}}return n(`[listTransactions] Transaction with ID ${r.transaction_id} not found after searching ${s} months`),{found:!1,transaction_details:[],total_items:0,message:`The transaction ID ${r.transaction_id} was not found in the last ${s} months. Please verify the transaction ID and try again, or let me know if there's anything else I can assist you with!`}}else{let s={...r};if(delete s.search_months,!s.end_date&&!s.start_date)s.end_date=new Date().toISOString(),s.start_date=new Date(new Date().getTime()-31*24*60*60*1e3).toISOString();else if(s.end_date)if(s.start_date){let c=new Date(s.start_date),d=new Date(s.end_date);(d.getTime()-c.getTime())/(24*60*60*1e3)>31&&(s.start_date=new Date(d.getTime()-31*24*60*60*1e3).toISOString())}else{let c=new Date(s.end_date);s.start_date=new Date(c.getTime()-31*24*60*60*1e3).toISOString()}else{let c=new Date(s.start_date);s.end_date=new Date(c.getTime()+31*24*60*60*1e3).toISOString()}let i=`${e.getBaseUrl()}/v1/reporting/transactions?${_(s)}`;n(`[listTransactions] API URL: ${i}`);try{n("[listTransactions] Sending request to PayPal API");let c=await u.get(i,{headers:a,params:s});return n(`[listTransactions] Transactions retrieved successfully. Status: ${c.status}`),c.data}catch(c){n("[listTransactions] Error listing transactions:",c.message),h(c)}}}async function ie(e,o,r){n(`[createRefund] Starting to refund capture for ID: ${r.capture_id}`);let{capture_id:a}=r,s=await e.getHeaders();n("[createRefund] Headers obtained");let i=`${e.getBaseUrl()}/v2/payments/captures/${a}/refund`;n(`[createRefund] API URL: ${i}`);try{n("[createRefund] Sending request to PayPal API");let c=await u.post(i,r,{headers:s});return n(`[createRefund] Capture refunded successfully. Status: ${c.status}`),c.data}catch(c){n(`[createRefund] Error refunding capture for ID: ${a}:`,c.message),h(c)}}async function se(e,o,r){n(`[getRefund] Starting to get refund details for ID: ${r.refund_id}`);let{refund_id:a}=r,s=await e.getHeaders();n("[getRefund] Headers obtained");let i=`${e.getBaseUrl()}/v2/payments/refunds/${a}`;n(`[getRefund] API URL: ${i}`);try{n("[getRefund] Sending request to PayPal API");let c=await u.get(i,{headers:s});return n(`[getRefund] Refund details retrieved successfully. Status: ${c.status}`),c.data}catch(c){n(`[getRefund] Error retrieving refund details for ID: ${a}:`,c.message),h(c)}}function h(e){if(n("[handleAxiosError] Processing error from PayPal API"),e.response){n(`[handleAxiosError] Response error status: ${e.response.status}`),n(`[handleAxiosError] Response error headers: ${JSON.stringify(e.response.headers)}`);try{let o=e.response.data;n(`[handleAxiosError] Error data: ${JSON.stringify(o)}`);let r=o.message||"Unknown error";if(o.details&&Array.isArray(o.details)){let a=o.details.map(s=>s.description||"").filter(Boolean).join("; ");a&&(r+=": "+a,n(`[handleAxiosError] Error details: ${a}`))}throw n(`[handleAxiosError] Throwing error with message: PayPal API error (${e.response.status}): ${r}`),new Error(`PayPal API error (${e.response.status}): ${r}`)}catch{throw n("[handleAxiosError] Error parsing response data, using raw data"),n(`[handleAxiosError] Throwing error with message: PayPal API error (${e.response.status}): ${e.response.data}`),new Error(`PayPal API error (${e.response.status}): ${e.response.data}`)}}else throw e.request?(n("[handleAxiosError] No response received from PayPal API"),n(`[handleAxiosError] Request: ${JSON.stringify(e.request)}`),n(`[handleAxiosError] Throwing error with message: PayPal API error: No response received - ${e.message}`),new Error(`PayPal API error: No response received - ${e.message}`)):(n(`[handleAxiosError] Error setting up request: ${e.message}`),n(`[handleAxiosError] Throwing error with message: PayPal API error: ${e.message}`),new Error(`PayPal API error: ${e.message}`))}import{Client as At,Environment as ae,LogLevel as Ot}from"@paypal/paypal-server-sdk";import ce from"axios";import{Buffer as $t}from"buffer";import de from"os";var oe="1.3.5";import Et from"debug";var pe=Et("agent-toolkit:client"),C=class{_sdkClient;_clientId;_clientSecret;_isSandbox;_accessToken;_baseUrl;_context;constructor({clientId:o,clientSecret:r,context:a,accessToken:s}){this._context=a;let i=this._context.debug??!1;this._clientId=o,this._clientSecret=r,this._isSandbox=this._context?.sandbox??!1,this._accessToken=s,this._clientId!==void 0&&this._clientSecret!==void 0&&this.createSDKClient(this._clientId,this._clientSecret,i),this._baseUrl=this._isSandbox?"https://api.sandbox.paypal.com":"https://api.paypal.com",pe(`[PayPal Setttings] Environment: ${this._isSandbox?"Sandbox":"Live"}`),pe(`[PayPal Setttings] API Base: ${this._baseUrl}`)}createSDKClient(o,r,a){this._sdkClient=new At({clientCredentialsAuthCredentials:{oAuthClientId:o,oAuthClientSecret:r},timeout:0,environment:this._isSandbox?ae.Sandbox:ae.Production,...a&&{logging:{logLevel:Ot.Info,maskSensitiveHeaders:!0,logRequest:{logBody:!0},logResponse:{logBody:!0,logHeaders:!0}}}})}async getAccessToken(){let o=$t.from(`${this._clientId}:${this._clientSecret}`).toString("base64"),r=this._baseUrl+"/v1/oauth2/token";try{return(await ce.post(r,"grant_type=client_credentials",{headers:{Authorization:`Basic ${o}`,"Content-Type":"application/x-www-form-urlencoded","User-Agent":this.generateUserAgent()}})).data.access_token}catch(a){throw ce.isAxiosError(a)?new Error(`Failed to fetch access token: ${a.response?.data?.error_description||a.message}`):new Error(`Failed to fetch access token: ${a instanceof Error?a.message:String(a)}`)}}getBaseUrl(){return this._baseUrl}async getHeaders(){let o={"Content-Type":"application/json"};return this._accessToken=this._accessToken||await this.getAccessToken(),o.Authorization=`Bearer ${this._accessToken}`,this._context.request_id&&(o["PayPal-Request-Id"]=this._context.request_id),this._context.tenant_context&&(o["PayPal-Tenant-Context"]=JSON.stringify(this._context.tenant_context)),o["User-Agent"]=this.generateUserAgent(),o}generateUserAgent(){return[`PayPal Agent Toolkit Typescript: ${this._context.source}`,`Version: ${oe}`,`on OS: ${de.platform()} ${de.release()}`].filter(Boolean).join(", ")}},x=C;var w=class{paypalClient;context;baseUrl;accessToken;constructor(o,r){this.context=r||{},this.context.sandbox=this.context.sandbox??!1,this.baseUrl=this.context.sandbox?"https://api-m.sandbox.paypal.com":"https://api-m.paypal.com",typeof o=="string"?(this.accessToken=o,this.paypalClient=new x({context:this.context,accessToken:this.accessToken})):this.paypalClient=o}async run(o,r){try{let a=await this.executeMethod(o,r);return JSON.stringify(a)}catch(a){let s=a.message||"Unknown error";return JSON.stringify({error:{message:s,type:"paypal_error"}})}}async executeMethod(o,r){switch(o){case"create_invoice":return U(this.paypalClient,this.context,r);case"list_invoices":return q(this.paypalClient,this.context,r);case"get_invoice":return j(this.paypalClient,this.context,r);case"send_invoice":return T(this.paypalClient,this.context,r);case"send_invoice_reminder":return L(this.paypalClient,this.context,r);case"cancel_sent_invoice":return B(this.paypalClient,this.context,r);case"generate_invoice_qr_code":return H(this.paypalClient,this.context,r);case"create_product":return N(this.paypalClient,this.context,r);case"list_products":return G(this.paypalClient,this.context,r);case"show_product_details":return z(this.paypalClient,this.context,r);case"create_subscription_plan":return M(this.paypalClient,this.context,r);case"list_subscription_plans":return Q(this.paypalClient,this.context,r);case"show_subscription_plan_details":return V(this.paypalClient,this.context,r);case"create_subscription":return F(this.paypalClient,this.context,r);case"show_subscription_details":return I(this.paypalClient,this.context,r);case"cancel_subscription":return J(this.paypalClient,this.context,r);case"update_subscription":return Y(this.paypalClient,this.context,r);case"create_shipment_tracking":return Z(this.paypalClient,this.context,r);case"get_shipment_tracking":return X(this.paypalClient,this.context,r);case"create_order":return K(this.paypalClient,this.context,r);case"get_order":return S(this.paypalClient,this.context,r);case"pay_order":return W(this.paypalClient,this.context,r);case"list_disputes":return ee(this.paypalClient,this.context,r);case"get_dispute":return te(this.paypalClient,this.context,r);case"accept_dispute_claim":return re(this.paypalClient,this.context,r);case"list_transactions":return ne(this.paypalClient,this.context,r);case"create_refund":return ie(this.paypalClient,this.context,r);case"get_refund":return se(this.paypalClient,this.context,r);default:throw new Error(`Invalid method: ${o}`)}}},le=w;function ue(e,o){for(let r in e.actions)for(let a in e.actions[r])if(o.actions[r]&&o.actions[r][a])return!0;return!1}var he=e=>`
Create Invoices on PayPal.

This function is used to create an invoice in the PayPal system. It allows you to generate a new invoice, specifying details such as customer information, items, quantities, pricing, and tax information. Once created, an invoice can be sent to the customer for payment.
`,me=e=>`
List invoices from PayPal.

This function retrieves a list of invoices with optional pagination parameters.
`,ge=e=>`
Get an invoice from PayPal.

This function retrieves details of a specific invoice using its ID.
`,fe=e=>`
Send an invoice to the recipient(s).

This function sends a previously created invoice to its intended recipients.
`,ye=e=>`
Send a reminder for an invoice.

This function sends a reminder for an invoice that has already been sent but hasn't been paid yet.
`,be=e=>`
Cancel a sent invoice.

This function cancels an invoice that has already been sent to the recipient(s).
`,Pe=e=>`
Generate a QR code for an invoice.

This function generates a QR code for an invoice, which can be used to pay the invoice using a mobile device or scanning app.
`,_e=e=>`
Create a product in PayPal using product catalog - create products API.
This function creates a new product that will be used in subscription plans, subscriptions.
Required parameters are: name (product name), type (product type).
High level: 
    - id: (auto-generated or specify SKU of the product) The ID of the product
    - name: {product_name} (required) 
    - description: {product_description} (optional)
    - type {DIGITAL | PHYSICAL | SERVICE} (required)
    - category: {product_category} (optional) 
    - image_url: {image_url} (optional)
    - home_url: {home_url} (optional)

Below is the payload request structure:
{
    "id": "#PROD-XYAB12ABSB7868434",
    "name": "Video Streaming Service",
    "description": "Service for streaming latest series, movies etc.",
    "type": "SERVICE",
    "category": "SOFTWARE",
    "image_url": "https://example.com/streaming.jpg",
    "home_url": "https://example.com/home"
}

`,xe=e=>`
List products from PayPal.

This function retrieves a list of products with optional pagination parameters.
`,ve=e=>`
List products from PayPal.

This function retrieves a list of products with optional pagination parameters.
`,Te=e=>`
Update a product in PayPal.

This function updates an existing product using JSON Patch operations.
`,Ie=e=>`
Create a subsctiption plan in PayPal using subscription - create plan API.
This function creates a new subscription plan that defines pricing and billing cycle details for subscriptions.
Required parameters are: product_id (the ID of the product for which to create the plan), name (subscription plan name), billing_cycles (billing cycle details).
High level: product_id, name, description, taxes, status: {CREATED|INACTIVE|ACTIVE}, billing_cycles, payment_preferences are required in json object.
While creating billing_cycles object, trial(second) billing cycle should precede regular billing cycle.
`,Se=e=>`
List subscription plans from PayPal.

This function retrieves a list of subscription plans with optional product filtering and pagination parameters.
`,Ce=e=>`
Show subscription plan details from PayPal.
This function retrieves the details of a specific subscription plan using its ID.
Required parameters are: plan_id (the ID of the subscription plan).
`,we=e=>`
Create a subscription in PayPal using the subscription - create subscription API.
This function allows you to create a new subscription for a specific plan, enabling the management of recurring payments.
The only required parameter is plan_id (the ID of the subscription plan). All other fields are optional and can be omitted if not provided.
The subscriber field is optional. If no subscriber information is provided, omit the subscriber field in the request payload.
The shipping address is optional. If no shipping address is provided, set the shipping_preference to GET_FROM_FILE in the application context.
The application context is also optional. If no application context information is provided, omit the application context field in the request payload.
`,De=e=>`
Show subscription details from PayPal.
This function retrieves the details of a specific subscription using its ID.
Required parameters are: subscription_id (the ID of the subscription).
`,Re=e=>`
Cancel a customer subscription in PayPal.

This function cancels an active subscription for a customer. It requires the subscription ID and an optional reason for cancellation.
Required parameters are: subscription_id (the ID of the subscription to be canceled).
Below is the payload request structure:
{
    "reason": "Customer requested cancellation"
}
You MUST ask the user for: 
 - subscription_id
 - reason for cancellation.

Return all of the above as structured JSON in your response.
`,Ae=e=>`
Update a customer subscription in PayPal.

This function updates an active or suspended subscription for a customer. It requires the subscription ID and payload of allowed keys to update to the subscription.
Required parameters are: subscription_id (the ID of the subscription to be updated), and at-least one key to update

Return response as structured JSON in your response.
`,Oe=e=>`
Create a shipment for a transaction in PayPal.
This function creates a shipment record for a specific transaction, allowing you to track the shipment status and details.
The transaction_id can fetch from the captured payment details in the order information.
Required parameters are: tracking_number (the tracking number for the shipment), transaction_id (the transaction ID associated with the shipment). 
High level: tracking_number, transaction_id, status (optional), carrier (optional) are required json objects.
Below is the payload request structure:
{
    "tracking_number": "1234567890",
    "transaction_id": "9XJ12345ABC67890",
    "status": "SHIPPED", // Required: ON_HOLD, SHIPPED, DELIVERED, CANCELLED
    "carrier": "UPS" // Required: The carrier handling the shipment. Link to supported carriers: http://developer.paypal.com/docs/tracking/reference/carriers/
}
`,$e=e=>`
Get tracking information for a shipment by ID.
This function retrieves tracking information for a specific shipment using the transaction ID and tracking number.
The transaction_id can fetch from the captured payment details in the order information.
Below is the payload request structure:
`,Ee=e=>`
Create an order in PayPal.

This tool is used to create a new order in PayPal. This is typically the first step in initiating a payment flow. It sets up an order with specified details such as item(s) to be purchased, quantity, amount, currency, and other details.
`,ke=e=>`
Retrieves the order details from PayPal for a given order ID.

This tool is used to retrieve details of an existing order in PayPal. It provides information about the order, including items, amounts, status, and other relevant details.
`,Ue=e=>`
Capture a payment for an order.

This tool is used to capture a payment for an order. It allows you to capture funds that have been authorized for a specific order but not yet captured.
`,qe=e=>`
List disputes from PayPal.

This function retrieves a list of disputes with optional pagination and filtering parameters.
`,je=e=>`
Get details for a specific dispute from PayPal.

This tool is used to lists disputes with a summary set of details, which shows the dispute_id, reason, status, dispute_state, dispute_life_cycle_stage, dispute_channel, dispute_amount, create_time and update_time fields.
`,Le=e=>`
Accept liability for a dispute claim.

This tool is used to accept liability for a dispute claim. When you accept liability for a dispute claim, the dispute closes in the customer's favor and PayPal automatically refunds money to the customer from the merchant's account.
`,Be=e=>`
List transactions from PayPal.

This tool is used to list transactions with optional filtering parameters within a date range of 31 days. This tool can also be used to list details of a transaction given the transaction ID.

- The start_date and end_date should be specified in ISO8601 date and time format. Example dates: 1996-12-19T16:39:57-08:00, 1985-04-12T23:20:50.52Z, 1990-12-31T23:59:60Z
- The transaction_status accepts the following 4 values:
    1. "D" - represents denied transactions.
    2. "P" - represents pending transactions.
    3. "S" - represents successful transactions.
    4. "V" - represents transactions that were reversed.
- The transaction_id is the unique identifier for the transaction.
`,He=e=>`
Retrieve detailed information about a PayPal payment refund.
If you have an order ID instead of a refund ID, first use the get order tool to obtain the refund ID from the order details. 
This function returns comprehensive details about a refund, including its current status (completed, pending, cancelled), refunded amount, and processing information.
When multiple refunds exist for an order or capture, request clarification on which specific refund to retrieve. 
Response details include:
- Refund status and ID
- Refunded amount and currency
- Reason for refund (if provided)
- Source transaction details
`,Ne=e=>`
Initiate a refund for a PayPal payment capture.
If you have an order ID instead of a capture ID, first use the get order tool to obtain the capture ID from the order details.
This function allows you to return funds to a customer by refunding a previously captured payment. You can issue a full refund or specify a partial amount. If multiple captures exist for an order, request clarification on which specific capture to refund.
Required parameters:
- Capture ID: The ID of the capture to refund
- Amount (optional): For partial refunds, specify the amount to refund (must be less than or equal to the captured amount)
- Note to Payer (optional): Additional explanation visible to the customer
Response details include:
- Refund ID and status
- Refunded amount and currency
`;import{z as t}from"zod";var kt=t.object({name:t.string().describe("The name of the item"),quantity:t.string().describe("The quantity of the item that the invoicer provides to the payer. Value is from -1000000 to 1000000. Supports up to five decimal places. Cast to string"),unit_amount:t.object({currency_code:t.string().describe("Currency code of the unit amount"),value:t.string().describe("The unit price. Up to 2 decimal points")}).describe("unit amount object"),tax:t.object({name:t.string().optional().describe("Tax name"),percent:t.string().optional().describe("Tax Percent")}).optional().describe("tax object"),unit_of_measure:t.enum(["QUANTITY","HOURS","AMOUNT"]).optional().describe("The unit of measure for the invoiced item")}).describe("invoice line item object"),Ge=e=>t.object({detail:t.object({invoice_date:t.string().optional().describe("The invoice date in YYYY-MM-DD format"),currency_code:t.string().describe("currency code of the invoice")}).describe("The invoice detail"),invoicer:t.object({business_name:t.string().max(300).describe("business name of the invoicer"),name:t.object({given_name:t.string().optional().describe("given name of the invoicer"),surname:t.string().optional().describe("surname of the invoicer")}).optional().describe("name of the invoicer"),email_address:t.string().optional().describe("email address of the invoicer")}).optional().describe("The invoicer business information that appears on the invoice."),primary_recipients:t.array(t.object({billing_info:t.object({name:t.object({given_name:t.string().optional().describe("given name of the recipient"),surname:t.string().optional().describe("surname of the recipient")}).optional().describe("name of the recipient"),email_address:t.string().describe("email address of the recipient").optional()}).describe("The billing information of the invoice recipient").optional()})).describe("array of recipients").optional(),items:t.array(kt).describe("Array of invoice line items").optional()}).describe("create invoice request payload"),ze=e=>t.object({invoice_id:t.string().describe("The ID of the invoice to retrieve.")}),Me=e=>t.object({page:t.number().default(1).optional().describe("The page number of the result set to fetch.").default(1),page_size:t.number().min(1).max(100).default(100).optional().describe("The number of records to return per page (maximum 100)."),total_required:t.boolean().optional().describe("Indicates whether the response should include the total count of items.")}),Qe=e=>t.object({invoice_id:t.string().describe("The ID of the invoice to send."),note:t.string().optional().describe("A note to the recipient."),send_to_recipient:t.boolean().optional().describe("Indicates whether to send the invoice to the recipient."),additional_recipients:t.array(t.string()).optional().describe("Additional email addresses to which to send the invoice.")}),Ve=e=>t.object({invoice_id:t.string().describe("The ID of the invoice for which to send a reminder."),subject:t.string().optional().describe("The subject of the reminder email."),note:t.string().optional().describe("A note to the recipient."),additional_recipients:t.array(t.string()).optional().describe("Additional email addresses to which to send the reminder.")}),Fe=e=>t.object({invoice_id:t.string().describe("The ID of the invoice to cancel."),note:t.string().optional().describe("A cancellation note to the recipient."),send_to_recipient:t.boolean().optional().describe("Indicates whether to send the cancellation to the recipient."),additional_recipients:t.array(t.string()).optional().describe("Additional email addresses to which to send the cancellation.")}),Je=e=>t.object({invoice_id:t.string().describe("The invoice id to generate QR code for"),width:t.number().default(300).describe("The QR code width"),height:t.number().default(300).describe("The QR code height")}).describe("generate invoice qr code request payload"),Ye=e=>t.object({product_id:t.string().describe("The ID of the product to update."),operations:t.array(t.object({}).passthrough()).describe("The PATCH operations to perform on the product.")}),Ke=e=>t.object({order_id:t.string().describe("The ID of the order for which to create a shipment").optional(),tracking_number:t.string().describe("The tracking number for the shipment. Id is provided by the shipper. This is required to create a shipment."),transaction_id:t.string().describe("The transaction ID associated with the shipment. Transaction id available after the order is paid or captured. This is required to create a shipment."),status:t.string().optional().describe('The status of the shipment. It can be "ON_HOLD", "SHIPPED", "DELIVERED", or "CANCELLED".').default("SHIPPED"),carrier:t.string().optional().describe("The carrier handling the shipment.")}),We=e=>t.object({order_id:t.string().describe("The ID of the order for which to create a shipment.").optional(),transaction_id:t.string().describe("The transaction ID associated with the shipment tracking to retrieve.").optional()}),Ut=t.object({itemCost:t.number().describe("The cost of each item - upto 2 decimal points."),taxPercent:t.number().describe("The tax percent for the specific item.").default(0),itemTotal:t.number().describe("The total cost of this line item.")}),qt=t.object({name:t.string().describe("The name of the item."),quantity:t.number().describe("The item quantity. Must be a whole number.").default(1),description:t.string().describe("The detailed item description.").optional()}).merge(Ut),jt=t.object({address_line_1:t.string().describe("The first line of the address, such as number and street, for example, `173 Drury Lane`.This field needs to pass the full address.").optional(),address_line_2:t.string().describe("The second line of the address, for example, a suite or apartment number.").optional(),admin_area_2:t.string().describe("A city, town, or village. Smaller than `admin_area_level_1`.").optional(),admin_area_1:t.string().describe("The highest-level sub-division in a country, which is usually a province, state, or ISO-3166-2 subdivision. ").optional(),postal_code:t.string().describe("The postal code, which is the ZIP code or equivalent. Typically required for countries with a postal code or an equivalent.").optional(),country_code:t.string().describe("The 2-character ISO 3166-1 code that identifies the country or region. Note: The country code for Great Britain is `GB` and not `UK` as used in the top-level domain names for that country.").length(2).optional()}).describe("The shipping address for the order."),v=e=>t.object({currencyCode:t.enum(["USD"]).describe("Currency code of the amount."),items:t.array(t.lazy(()=>qt)).max(50),discount:t.number().describe("The discount amount for the order.").default(0).optional(),shippingCost:t.number().describe("The cost of shipping for the order.").default(0).optional(),shippingAddress:t.optional(jt.nullable()).default(null).describe("The shipping address for the order."),notes:t.string().optional().nullable().default(null),returnUrl:t.string().optional().default("https://example.com/returnUrl"),cancelUrl:t.string().optional().default("https://example.com/cancelUrl")}),Ze=e=>t.object({id:t.string().describe("The order id generated during create call")}),Xe=e=>t.object({id:t.string().describe("The order id generated during create call")}),et=e=>t.object({disputed_transaction_id:t.string().nullable().default(null),dispute_state:t.enum(["REQUIRED_ACTION","REQUIRED_OTHER_PARTY_ACTION","UNDER_PAYPAL_REVIEW","RESOLVED","OPEN_INQUIRIES","APPEALABLE"]).optional().describe("OPEN_INQUIRIES"),page_size:t.number().default(10).optional(),page:t.number().default(1).optional()}),tt=e=>t.object({dispute_id:t.string().describe("The order id generated during create call")}),rt=e=>t.object({dispute_id:t.string(),note:t.string().describe("A note about why the seller is accepting the claim")}),nt=e=>t.object({transaction_id:t.string().optional().describe("The ID of the transaction to retrieve.").nullable().default(null),transaction_status:t.enum(["D","P","S","V"]).optional().default("S"),start_date:t.string().describe("Filters the transactions in the response by a start date and time, in ISO8601 date and time format. Seconds are required. Fractional seconds are optional.").optional().default(()=>{let o=new Date;return o.setDate(o.getDate()-31),o.toISOString()}),end_date:t.string().describe("Filters the transactions in the response by an end date and time, in ISO8601 date and time format. Seconds are required. Fractional seconds are optional. The maximum supported range is 31 days.").optional().default(()=>{let o=new Date;return o.setDate(o.getDate()),o.toISOString()}),search_months:t.number().optional().describe("Number of months to search back for a transaction by ID. Default is 12 months.").default(12),page_size:t.number().default(100).optional(),page:t.number().default(1).optional()}),it=e=>t.object({name:t.string().describe("The product name."),type:t.enum(["PHYSICAL","DIGITAL","SERVICE"]).describe("The product type. Value is PHYSICAL, DIGITAL, or SERVICE."),description:t.string().optional().describe("The product description."),category:t.string().optional().describe("The product category."),image_url:t.string().optional().describe("The image URL for the product."),home_url:t.string().optional().describe("The home page URL for the product.")}),st=e=>t.object({page:t.number().optional().describe("The page number of the result set to fetch."),page_size:t.number().optional().describe("The number of records to return per page (maximum 100)."),total_required:t.boolean().optional().describe("Indicates whether the response should include the total count of products.")}),ot=e=>t.object({product_id:t.string().describe("The ID of the product to update.")}),Lt=t.object({interval_unit:t.enum(["DAY","WEEK","MONTH","YEAR"]).describe("The unit of time for the billing cycle."),interval_count:t.number().describe("The number of units for the billing cycle.")}).passthrough(),Bt=t.object({currency_code:t.enum(["USD"]).describe("The currency code for the fixed price."),value:t.string().describe("The value of the fixed price.")}).passthrough().optional().describe("The fixed price for the subscription plan."),Ht=t.object({fixed_price:Bt,version:t.string().optional().describe("The version of the pricing scheme.")}).passthrough(),Nt=t.object({frequency:Lt.describe("The frequency of the billing cycle."),tenure_type:t.enum(["REGULAR","TRIAL"]).describe("The type of billing cycle tenure."),sequence:t.number().describe("The sequence of the billing cycle."),total_cycles:t.number().optional().describe("The total number of cycles in the billing plan."),pricing_scheme:Ht.describe("The pricing scheme for the billing cycle.")}).passthrough(),Gt=t.object({currency_code:t.enum(["USD"]).optional().describe("The currency code for the setup fee."),value:t.string().optional().describe("The value of the setup fee.")}).passthrough().optional(),at=t.boolean().optional().describe("Indicates whether to automatically bill outstanding amounts."),ct=t.number().optional().describe("The number of failed payments before the subscription is canceled."),zt=t.object({auto_bill_outstanding:at,setup_fee:Gt.describe("The setup fee for the subscription plan."),setup_fee_failure_action:t.enum(["CONTINUE","CANCEL"]).optional().describe("The action to take if the setup fee payment fails."),payment_failure_threshold:ct}).passthrough().optional(),dt=t.string().optional().describe("The tax percentage."),pt=t.boolean().optional().describe("Indicates whether the tax is inclusive."),Mt=t.object({percentage:dt,inclusive:pt}).passthrough().optional(),lt=e=>t.object({product_id:t.string().describe("The ID of the product for which to create the plan."),name:t.string().describe("The subscription plan name."),description:t.string().optional().describe("The subscription plan description."),billing_cycles:t.array(Nt).describe("The billing cycles of the plan."),payment_preferences:zt.describe("The payment preferences for the subscription plan."),taxes:Mt.describe("The tax details.")}),ut=e=>t.object({product_id:t.string().optional().describe("The ID of the product for which to get subscription plans."),page:t.number().optional().describe("The page number of the result set to fetch."),page_size:t.number().optional().describe("The number of records to return per page (maximum 100)."),total_required:t.boolean().optional().describe("Indicates whether the response should include the total count of plans.")}),ht=e=>t.object({plan_id:t.string().describe("The ID of the subscription plan to show.")}),mt=t.object({given_name:t.string().optional().describe("The subscriber given name."),surname:t.string().optional().describe("The subscriber last name.")}).optional().describe("The subscriber name."),Qt=t.object({address_line_1:t.string().describe("The first line of the address."),address_line_2:t.string().optional().describe("The second line of the address."),admin_area_1:t.string().describe("The city or locality."),admin_area_2:t.string().describe("The state or province."),postal_code:t.string().describe("The postal code."),country_code:t.enum(["US"]).describe("The country code.")}).optional().describe("The shipping address."),gt=t.object({name:mt.describe("The subscriber shipping address name."),address:Qt}).optional().describe("The subscriber shipping address."),Vt=t.object({payer_selected:t.enum(["PAYPAL","CREDIT_CARD"]).describe("The payment method selected by the payer."),payee_preferred:t.enum(["IMMEDIATE_PAYMENT_REQUIRED","INSTANT_FUNDING_SOURCE"]).optional().describe("The preferred payment method for the payee.")}).optional().describe("The payment method details."),Ft=t.object({currency_code:t.enum(["USD"]).describe("The currency code for the shipping amount."),value:t.string().describe("The value of the shipping amount.")}).optional().describe("The shipping amount for the subscription."),Jt=t.object({name:mt,email_address:t.string().optional().describe("The subscriber email address."),shipping_address:gt}).optional().describe("The subscriber details."),Yt=t.object({brand_name:t.string().describe("The brand name."),locale:t.string().optional().describe("The locale for the subscription."),shipping_preference:t.enum(["SET_PROVIDED_ADDRESS","GET_FROM_FILE"]).optional().describe("The shipping preference."),user_action:t.enum(["SUBSCRIBE_NOW","CONTINUE"]).optional().describe("The user action."),return_url:t.string().describe("The return URL after the subscription is created."),cancel_url:t.string().describe("The cancel URL if the user cancels the subscription."),payment_method:Vt}).optional().describe("The application context for the subscription."),ft=e=>t.object({plan_id:t.string().describe("The ID of the subscription plan to create."),quantity:t.number().optional().describe("The quantity of the product in the subscription."),shipping_amount:Ft,subscriber:Jt,application_context:Yt}),yt=e=>t.object({subscription_id:t.string().describe("The ID of the subscription to show details."),get_additional_details:t.boolean().optional().describe("Get all detailed information for the subscription.")}),bt=e=>t.object({subscription_id:t.string().describe("The ID of the subscription to show details."),payload:t.object({reason:t.string().describe("The reason for the cancellation of a subscription.")}).passthrough().describe("Payload for subscription cancellation.")}),Pt=e=>t.object({subscription_id:t.string().describe("The ID of the subscription to update."),currency_code:t.enum(["USD"]).optional().default("USD").describe("Currency code of the amount."),outstanding_balance:t.string().optional().describe("Outstanding Balance in the subscription"),custom_id:t.string().optional().describe("The custom id for the subscription"),fixed_price:t.object({value:t.string().describe("The fixed price for the subscription."),sequence:t.number().describe("The order sequence for the billing cycles")}).optional().describe("The fixed price for a billing cycle."),payment_failure_threshold:ct,auto_bill_outstanding:at,taxes_inclusive:pt,taxes_percentage:dt,shipping_amount:t.string().optional().describe("The value of the shipping amount."),shipping_address:gt.optional().describe("The shipping address.")}),_t=e=>t.object({refund_id:t.string().describe("The ID of the refund to get details for.")}),xt=e=>t.object({capture_id:t.string().describe("The ID of the capture to refund."),amount:t.object({currency_code:t.string(),value:t.string()}).optional().describe("The amount to refund. If not specified, the full captured amount is refunded."),invoice_id:t.string().optional().describe("The invoice ID that is used to track this payment."),note_to_payer:t.string().optional().describe("A note to the payer.")});var vt=e=>[{method:"create_invoice",name:"Create Invoice",description:he(e),parameters:Ge(e),actions:{invoices:{create:!0}}},{method:"list_invoices",name:"List Invoices",description:me(e),parameters:Me(e),actions:{invoices:{list:!0}}},{method:"get_invoice",name:"Get Invoice",description:ge(e),parameters:ze(e),actions:{invoices:{get:!0}}},{method:"send_invoice",name:"Send Invoice",description:fe(e),parameters:Qe(e),actions:{invoices:{send:!0}}},{method:"send_invoice_reminder",name:"Send Invoice Reminder",description:ye(e),parameters:Ve(e),actions:{invoices:{sendReminder:!0}}},{method:"cancel_sent_invoice",name:"Cancel Sent Invoice",description:be(e),parameters:Fe(e),actions:{invoices:{cancel:!0}}},{method:"generate_invoice_qr_code",name:"Generate Invoice QR Code",description:Pe(e),parameters:Je(e),actions:{invoices:{generateQRC:!0}}},{method:"create_product",name:"Create Product",description:_e(e),parameters:it(e),actions:{products:{create:!0}}},{method:"list_products",name:"List Products",description:xe(e),parameters:st(e),actions:{products:{list:!0}}},{method:"update_product",name:"Update Product",description:Te(e),parameters:Ye(e),actions:{products:{update:!0}}},{method:"show_product_details",name:"Show Products Details",description:ve(e),parameters:ot(e),actions:{products:{show:!0}}},{method:"create_subscription_plan",name:"Create Subscription Plan",description:Ie(e),parameters:lt(e),actions:{subscriptionPlans:{create:!0}}},{method:"list_subscription_plans",name:"List Subscription Plans",description:Se(e),parameters:ut(e),actions:{subscriptionPlans:{list:!0}}},{method:"show_subscription_plan_details",name:"Show Subscription Plan Details",description:Ce(e),parameters:ht(e),actions:{subscriptionPlans:{show:!0}}},{method:"create_subscription",name:"Create Subscription",description:we(e),parameters:ft(e),actions:{subscriptions:{create:!0}}},{method:"show_subscription_details",name:"Show Subscription Details",description:De(e),parameters:yt(e),actions:{subscriptions:{show:!0}}},{method:"cancel_subscription",name:"Cancel Subscription",description:Re(e),parameters:bt(e),actions:{subscriptions:{cancel:!0}}},{method:"update_subscription",name:"Update Subscription",description:Ae(e),parameters:Pt(e),actions:{subscriptions:{update:!0}}},{method:"create_shipment_tracking",name:"Create shipment",description:Oe(e),parameters:Ke(e),actions:{shipment:{create:!0}}},{method:"get_shipment_tracking",name:"Get Shipment Tracking",description:$e(e),parameters:We(e),actions:{shipment:{get:!0}}},{method:"create_order",name:"Create Order",description:Ee(e),parameters:v(e),actions:{orders:{create:!0}}},{method:"get_order",name:"Get Order",description:ke(e),parameters:Ze(e),actions:{orders:{get:!0}}},{method:"pay_order",name:"Process payment for an authorized order",description:Ue(e),parameters:Xe(e),actions:{orders:{capture:!0}}},{method:"list_disputes",name:"List Disputes",description:qe(e),parameters:et(e),actions:{disputes:{list:!0}}},{method:"get_dispute",name:"Get Dispute",description:je(e),parameters:tt(e),actions:{disputes:{get:!0}}},{method:"accept_dispute_claim",name:"Accept dispute claim",description:Le(e),parameters:rt(e),actions:{disputes:{create:!0}}},{method:"list_transactions",name:"List Transactions",description:Be(e),parameters:nt(e),actions:{transactions:{list:!0}}},{method:"create_refund",name:"Create Refund",description:Ne(e),parameters:xt(e),actions:{payments:{createRefund:!0}}},{method:"get_refund",name:"Get Refund",description:He(e),parameters:_t(e),actions:{payments:{getRefunds:!0}}}],Kt=vt({}).reduce((e,o)=>(Object.keys(o.actions).forEach(r=>{e[r]={...e[r],...o.actions[r]}}),e),{}),Wt=Kt,Tt=vt;import{tool as Zt}from"ai";function D(e,o,r,a){return Zt({description:r,parameters:a,execute:s=>e.run(o,s)})}var Xt="AI-SDK",R=class{client;_paypal;_tools;constructor({clientId:o,clientSecret:r,configuration:a}){let s=a.context||{};this.client=new x({clientId:o,clientSecret:r,context:{...s,source:Xt}});let i=Tt(s).filter(c=>ue(c,a));this._paypal=new le(this.client,a.context),this._tools=i.reduce((c,d)=>(c[d.method]=D(this._paypal,d.method,d.description,d.parameters),c),{})}getTools(){return this._tools}},A=R;import{generateObject as er,generateText as P}from"ai";var O=class{toolkit;log;constructor({clientId:o,clientSecret:r,configuration:a,log:s}){this.log=s||console.log,this.toolkit=new A({clientId:o,clientSecret:r,configuration:a})}async generateOrder(o,r,a){this.log("Step 1: I am using the provided prompts to create a request object for PayPal.");let{object:s}=await er({model:o,schema:v({}),system:a,prompt:r});this.log(`Response 1: I have now created the request object with provided details;
 ${JSON.stringify(s)}`),this.log("Proceeding with next step."),this.log("Step 2: I am now choosing the correct tool from PayPal's toolkit to create an an order using the generated object from previous step.");let{text:i}=await P({model:o,tools:this.toolkit.getTools(),maxSteps:10,prompt:`Create an order using the following details: ${JSON.stringify(s,null,2)}`});this.log(`Response 2: I have created the order in PayPal's system with order ID: ${i}.`),this.log("Proceeding with next step."),this.log("Step 3: I am now choosing the correct tool from PayPal's toolkit to retrieve the order details with the order ID from previous step.");let{text:c}=await P({model:o,tools:this.toolkit.getTools(),maxSteps:10,system:"You are processing an order using PayPal APIs. Use the order ID to retrieve the order details.",prompt:`Retrieve the details of the order with ID: ${i}.`});this.log(`Response 3: Here is the order details with ID: ${i}; ${JSON.stringify(c,null,2)}`),this.log("Proceeding with next step."),this.log("Step 4: I am now generating the summary of the order using the order details retrieved in the previous step. This makes it easier to read the important information.");let{text:d}=await P({model:o,maxSteps:10,system:"You are tasked with generating an summary text for the order. Use the provided order details. For each item in order, update item level tax to be the tax amount*quantity of the item. Show the payment approval link only at the end of the page for the customer and hide all other links related to the order.",prompt:`
                Generate a summary for the following order details: ${c}.
            `});return this.log(`Response 4: 
${d}`),d}async getDisputeDetails(o,r){this.log("Step 1. I am now retrieving the details from PayPal.");let{text:a}=await P({model:o,tools:this.toolkit.getTools(),maxSteps:10,system:"You are a tool to retrieve the dispute details based on the dispute ID.",prompt:r});this.log("Step 2. I am now generating the summary of the dispute using the dispute details retrieved in the previous step. This makes it easier to read the important information.");let{text:s}=await P({model:o,tools:this.toolkit.getTools(),system:"You are tasked with generating an summary text for the dispute. Use the provided dispute details. Show the appropriate links only at the end of the page.",prompt:`
                Generate a summary for the following dispute details: ${a}.
            `});return this.log(`Output: ${s}`),s}},tr=O;export{Wt as ALL_TOOLS_ENABLED,A as PayPalAgentToolkit,tr as PayPalWorkflows};
